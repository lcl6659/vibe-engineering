name: Demand Analysis with Claude

on:
  issues:
    types: [opened, labeled] # åˆ›å»ºæˆ–åæœŸåŠ æ ‡ç­¾éƒ½è§¦å‘

jobs:
  analyze:
    if: contains(github.event.issue.labels.*.name, 'claude-tech')
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
      id-token: write # æ·»åŠ  OIDC token æƒé™
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Run Claude Code Action
        uses: anthropics/claude-code-action@v1
        env:
          # OpenRouter é›†æˆé…ç½®ï¼ˆå‚è€ƒï¼šhttps://openrouter.ai/docs/guides/guides/claude-code-integrationï¼‰
          ANTHROPIC_BASE_URL: https://openrouter.ai/api
        with:
          # ä½¿ç”¨ OpenRouter API keyï¼ˆæ–‡æ¡£è¦æ±‚ä½¿ç”¨ anthropic_api_keyï¼‰
          anthropic_api_key: ${{ secrets.OPENROUTER_API_KEY }}
          # ä½¿ç”¨ GitHub token é¿å… OIDC token è·å–å¤±è´¥
          github_token: ${{ github.token }}
          track_progress: true
          prompt: |
            REPO: ${{ github.repository }}
            ISSUE NUMBER: ${{ github.event.issue.number }}
            TITLE: ${{ github.event.issue.title }}
            BODY: ${{ github.event.issue.body }}

            è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½éœ€æ±‚ Issueï¼Œè¯·ç”¨ä¸­æ–‡ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ç»“æ„åˆ†æå¹¶è¯„è®ºåˆ° Issue ä¸Šï¼š

            ğŸ— æŠ€æœ¯æ¶æ„è®¾è®¡
            é¢„è®¡å·¥æ—¶: X-Y å¤©

            ğŸ’¡ åˆ†ææ€è·¯
            - éœ€æ±‚åˆ†æ
            - æŠ€æœ¯å¤æ‚åº¦è¯„ä¼°
            - å…³é”®æŠ€æœ¯ç‚¹ï¼ˆå‰åç«¯ã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹ä¾èµ–ï¼‰
            - é£é™©ç‚¹

            ğŸ’¾ Backend Contract (Go)
            - API æ¥å£å®šä¹‰ï¼ˆè¯·æ±‚/å“åº”ç»“æ„ä½“ï¼‰
            - æ•°æ®åº“è¡¨ç»“æ„å˜æ›´
            - ç›¸å…³æ¨¡å‹æ›´æ–°
            - æœåŠ¡æ¥å£å®šä¹‰

            ğŸ¨ Frontend Contract
            - URL æ­£åˆ™åŒ¹é…
            - UI äº¤äº’æµç¨‹
            - çŠ¶æ€ç®¡ç†
            - é”™è¯¯å¤„ç†ä¸ä¼˜åŒ–ç‚¹

            ğŸ“‹ ä»»åŠ¡åˆ†è§£è¿›åº¦
            - å»ºè®®åˆ›å»ºçš„å­ Issue æ ‡é¢˜åˆ—è¡¨ï¼ˆç”¨ [ ] è¡¨ç¤ºï¼‰

            æœ€åä»¥ç»“æ„åŒ– JSON è¾“å‡ºä»»åŠ¡åˆ—è¡¨ï¼ˆä¾¿äºåç»­è‡ªåŠ¨åŒ–åˆ›å»ºå­ Issueï¼‰:
            {
              "tasks": ["[BE] xxx", "[FE] xxx", "..."]
            }
