name: PR Auto Review with Claude

on:
  pull_request:
    # 必须增加 labeled，这样你打标签时才会触发
    types: [opened, synchronize, reopened, labeled]

jobs:
  review:
    # 只有带 'claude-review' 标签时运行
    if: contains(github.event.pull_request.labels.*.name, 'claude-review')
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    steps:
      - name: Checkout PR Branch
        uses: actions/checkout@v5 # 严格遵循固定标准：v5 [cite: 2026-01-06]
        with:
          fetch-depth: 0 # 不指定 ref，自动适配当前 PR 分支

      - name: Run Claude Code Action
        uses: anthropics/claude-code-action@v1
        env:
          ANTHROPIC_BASE_URL: https://openrouter.ai/api
        with:
          # 固定标准配置
          anthropic_api_key: ${{ secrets.OPENROUTER_API_KEY }}
          github_token: ${{ github.token }}
          track_progress: true
          prompt: |
            I need you to review this PR #${{ github.event.pull_request.number }}.
            1. 请全面审查代码质量、逻辑错误和安全隐患。
            2. 严禁使用 nano 编辑器 [cite: 2026-01-05]。
            3. 请直接在 PR 的 Diff 处留下内联评论。
