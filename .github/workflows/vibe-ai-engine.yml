name: AI Tech Architect

on:
  issues:
    types: [labeled]

jobs:
  tech-arch:
    if: github.event.label.name == 'ğŸ›  tech'
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
      - name: "Tech Analysis"
        env:
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
          ISSUE_BODY: ${{ github.event.issue.body }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
        uses: actions/github-script@v7
        with:
          script: |
            const prompt = `ä½ æ˜¯ä¸€ä¸ªå…¨æ ˆä¸“å®¶ã€‚é’ˆå¯¹ä»¥ä¸‹éœ€æ±‚ï¼Œä¸º Go + Next.js å›¢é˜Ÿåˆ¶å®šæŠ€æœ¯æ–¹æ¡ˆï¼š
            æ ‡é¢˜: ${process.env.ISSUE_TITLE}
            æè¿°: ${process.env.ISSUE_BODY || "ï¼ˆæ— æè¿°ï¼‰"}
            
            è¯·ç»™å‡ºï¼šGo å…³é”® Struct å®šä¹‰ã€API å®šä¹‰ (REST/gRPC)ã€Next.js ç»„ä»¶å»ºè®®ã€‚`;

            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${process.env.OPENROUTER_API_KEY}`,
                'Content-Type': 'application/json',
                'HTTP-Referer': 'https://github.com/ai-tech-arch'
              },
              body: JSON.stringify({
                model: "anthropic/claude-sonnet-4.5",
                messages: [{ role: "user", content: prompt }]
              })
            });

            const data = await response.json();
            const aiResponse = data.choices[0].message.content;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: "ğŸ›  **AI æŠ€æœ¯æ¶æ„å»ºè®®:**\n\n" + aiResponse
            });
