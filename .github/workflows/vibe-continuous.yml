name: Vibe Continuous - 24小时自动迭代引擎

on:
  # 每小时运行一次，持续检测
  schedule:
    - cron: '0 * * * *'
  # 支持手动触发
  workflow_dispatch:
    inputs:
      issue_number:
        description: '指定检测的 Issue 编号（留空则检测所有）'
        required: false
        type: string
      mode:
        description: '运行模式'
        required: true
        default: 'scan'
        type: choice
        options:
          - scan        # 扫描所有进行中的 issue
          - check       # 检测指定 issue 完成度
          - continue    # 继续处理未完成任务
          - verify      # 验收模式：检测完成度，通过则关闭 issue

jobs:
  continuous-iteration:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
      pull-requests: read
      actions: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run Vibe Continuous Script
        uses: actions/github-script@v7
        with:
          script: |
            const script = require('./.github/scripts/vibe-continuous.js');
            await script({
              github,
              context,
              core,
              mode: '${{ github.event.inputs.mode }}' || 'scan',
              specificIssue: '${{ github.event.inputs.issue_number }}'
            });
